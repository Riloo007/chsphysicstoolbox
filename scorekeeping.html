<html>
<head>
  <title>Player Scoreboard</title>
  <script src="https://www.gstatic.com/firebasejs/7.20.0/firebase-app.js"></script>
  <script src="https://www.gstatic.com/firebasejs/7.20.0/firebase-database.js"></script>
</head>
<body id="body">
  <table>
    <tbody id="Lists">
      <tr>
        <td><input id="team1Header" value="Team 1"></td>
        <td><input id="team1Header" value="Team 2"></td>
      </tr>
      <tr>
        <td>
          <div class="pgf"><div>Player</div><div>Goals</div><div>Fouls</div></div>
          <ul id="team1List"></ul>
          <button id="addP1" onClick="addplayer(1, team1List.children.length)">Add Player</button>
          <br>
          <div id="cloudOptions1" style="border: 1px solid black; border-radius: 10px;">
            <h3>Cloud Save</h1>
            User index: <input id="userIndex1" value="1">
            <button onclick="saveToCloud(uindex1, 1)">Save to Cloud</button>
            <button onclick="fetchFromCloud(document.getElementById('userIndex1').value, 1)">Load from Cloud</button>
            <h4 id="message1"></h4>
          </div>
        </td>
        <td>
          <div class="pgf"><div>Player</div><div>Goals</div><div>Fouls</div></div>
          <ul id="team2List"></ul>
          <button id="addP2" onClick="addplayer(2, team1List.children.length + 500)">Add Player</button>
          <br>
          <div id="cloudOptions2" style="border: 1px solid black; border-radius: 10px;">
            <h3>Cloud Save</h1>
            User index: <input id="userIndex2" value="1">
            <button onclick="saveToCloud(document.getElementById('userIndex2').value, 2)">Save to Cloud</button>
            <button onclick="fetchFromCloud(document.getElementById('userIndex2').value, 2)">Load from Cloud</button>
            <h4 id="message2"></h4>
          </div>
        </td>
      </tr>
    </tbody>
  </table>

  <div id="colorSettings">
    Text color: <input id="pageColor" type="color" value="#0071b3">
    Background color: <input id="backgroundColor" type="color">
    Button color: <input id="buttonColor" type="color">
  </div>


  <button id="editBtn" onclick="toggleEditMode();">Please enable javascript execution to continue</button>
  <div id="pointers">
    <button id="pointer0">-1</button>
    <button id="pointer1" style="outline: solid white 1px;">+1</button>
    <button id="pointer2">+2</button>
    <button id="pointer3">+3</button>
  </div>
</body>
</html>




<style>
#colorSettings{
  border-radius: 10px;
  padding: 10px;
  border: solid 1px rgb(0, 113, 179);
}

@font-face {
  font-family: bitlcd;
  src: url(LCD2.ttf);
}

.pgf > div {
  display: inline-block;
  width: 33.33%;
}

* {
    font-family: 'Silkscreen', cursive;
    font-family: bitLCD;
    font-size: 30px;

  }
input:focus {
  z-index: 100;
  outline: none;
  background-color: rgb(37, 37, 37);
  border-radius: 5px;
}
input:focus:read-only {
  background-color: rgb(31, 31, 31);
}

button {
  border-radius: 10px;
  border: 0px;
  background-color: rgb(25, 27, 34);
  cursor: pointer;
  font-size: large;
}

#Lists > tr > td > table {
  width: 100%;
  text-align: center;
}
#Lists {
  text-align: center;
}

#team1List, #team2List {
  list-style-type: none;
  padding: 0;
  margin-top: 5px;
  margin-bottom: 5px;
}
#team1Header, #team2Header {
  font-size: 50px;
}

input {
  box-shadow: inset 0 0 10px #353535;

  border: none;
  border-radius: 5px;
  background-color: rgb(0, 0, 0);
  width: calc(100vw / 6.8);
  font-size: 25px;
  text-align: center;
  margin: 3px;
}

body {
  background-color: black;
  /*background: linear-gradient(90deg, rgb(5, 0, 109) 40%, rgb(177, 0, 0) 60%);*/
  text-align: center;
}
body

table {
  margin: auto;
}


*::selection {
  background:rgba(0, 0, 0, 0);
}
input:focus::selection {
  background:rgba(193, 193, 193, 128);
}
input:focus:read-only::selection {
  background:rgba(0, 0, 0, 0);
}
input:read-only {
  cursor: pointer;
}

#editBtn {
  font-size: 6vh;
  background-color: #00000000;
  height: min-content;
  display: block;
  position: fixed;
  right: 0;
  bottom: 0;
}

</style>

<style id="USTYLE">
  *{color: rgb(0, 113, 179);}
</style>

<script>

const pageColor = document.getElementById('pageColor');
const backgroundColor = document.getElementById('backgroundColor');
const buttonColor = document.getElementById('buttonColor');
const team1Header = document.getElementById("team1Header");
const team2Header = document.getElementById("team2Header");
const cloudOptions1 = document.getElementById("cloudOptions1");
const cloudOptions2 = document.getElementById("cloudOptions2");
const message1 = document.getElementById("message1");
const message2 = document.getElementById("message2");
const team1List = document.getElementById("team1List");
const team2List = document.getElementById("team2List");
const editBtn = document.getElementById("editBtn");
const addP1 = document.getElementById("addP1");
const addP2 = document.getElementById("addP2");
const uindex1 = document.getElementById('userIndex1');
const uindex2 = document.getElementById('userIndex2');
const colorSettings = document.getElementById("colorSettings");
const newplayer01 = "<li><input type='number' value='0' tabindex='";
const newplayer02 = "'><input type='number' value='0'><input type='number' value='0'><button onclick='removePlayer(this);'>-</button></li>";

let pointerAdd = 1;
let editMode = false;

function addplayer(i, d) {
  var ret
  if(i == 1) {
    //team1List.innerHTML += newplayer;
    team1List.appendChild(temp(newplayer01 + d + newplayer02));
    ret = team1List.children[team1List.children.length-1]
  } else {
    //team2List.innerHTML += newplayer;
    team2List.appendChild(temp(newplayer01 + d + newplayer02));
    ret = team2List.children[team2List.children.length-1];
  }
  //console.log(ret);
  return ret;
}
function removePlayer(i) {
  i.parentElement.remove();
}

function incVal(i) {
  i.value = parseInt(i.value) + pointerAdd;
  if(i.value >= 5) {i.style.color = 'rgb(179, 161, 0)';}
  //i.value += 1;
}

function temp(htmlString) {
  var div = document.createElement('div');
  div.innerHTML = htmlString.trim();

  // Change this to div.childNodes to support multiple top-level nodes.
  return div.firstChild;
}

function toggleEditMode() {
  console.log("TOGGLE");
  editMode = !editMode;

  if (!editMode) {
    editBtn.innerText = "⚙︎";
    cloudOptions1.style.display = 'block';
    cloudOptions2.style.display = 'block';
    colorSettings.style.display = 'block';
    team1Header.contentEditable = true;
    team2Header.contentEditable = true;
    addP1.style.display = 'table-row';
    addP2.style.display = 'table-row';
  } else {
    editBtn.innerText = "⚙︎";
    cloudOptions1.style.display = 'none';
    cloudOptions2.style.display = 'none';
    colorSettings.style.display = 'none';
    team1Header.contentEditable = false;
    team2Header.contentEditable = false;
    addP1.style.display = 'none';
    addP2.style.display = 'none';
    message1.innerHTML = '';
    message2.innerHTML = '';
  }

  for (let i = 0; i < team1List.children.length; i++) {
    let player = team1List.children[i];

    player.children[0].readOnly = editMode;
    player.children[1].readOnly = editMode;
    player.children[2].readOnly = editMode;
    console.log(player.children[0].readOnly);
  

    if(!editMode) {
      player.children[3].style.display = 'table-cell';
      player.children[1].setAttribute('onclick','');
      player.children[2].setAttribute('onclick','');
    } else {
      player.children[3].style.display = 'none';
      player.children[1].setAttribute('onclick','incVal(this)');
      player.children[2].setAttribute('onclick','incVal(this)');
    }
  }
  for (let i = 0; i < team2List.children.length; i++) {
    let player = team2List.children[i];

    player.children[0].readOnly = editMode;
    player.children[1].readOnly = editMode;
    player.children[2].readOnly = editMode;

    if(!editMode) {
      player.children[3].style.display = 'table-cell';
      player.children[1].setAttribute('onclick','');
      player.children[2].setAttribute('onclick','');
    } else {
      player.children[3].style.display = 'none';
      player.children[1].setAttribute('onclick','incVal(this)');
      player.children[2].setAttribute('onclick','incVal(this)');
    }
  }


};

for(x=1;x<15;x++) {
  addplayer(1, x);
  addplayer(2, x+100);
}

toggleEditMode();


var database;
function setupFirebase() {
  const firebaseConfig = {
    databaseURL: "https://scorekeeping-c6efa-default-rtdb.firebaseio.com/"
  };
  firebase.initializeApp(firebaseConfig);
  database = firebase.database();
}

function pad(num) {
  num = num.toString();
  while (num.length < 3) num = "0" + num;
  return num;
}

function saveToCloud(id, team) {
  id = id.toUpperCase();
  var dataString;
  // 

  if(team == 1) {
    dataString = pad(team1List.children.length);
    //014
    for (let i = 0; i < team1List.children.length; i++) {
      let player = team1List.children[i];
      dataString += pad(player.children[0].value) + pad(player.children[1].value) + pad(player.children[2].value);
    }
    dataString += team1Header.innerHTML;
  } else {
    dataString = pad(team2List.children.length);
    //014
    for (let i = 0; i < team2List.children.length; i++) {
      let player = team2List.children[i];
      dataString += pad(player.children[0].value) + pad(player.children[1].value) + pad(player.children[2].value);
    }
    dataString += team2Header.innerHTML;
  }

  firebase.database().ref('users/' + id).set({
    val: dataString
  });

  if(team == 1) {message1.innerHTML = "Saved to user <span style='color: rgb(179, 161, 0)'>" + id + "</span>!";}
  else {message2.innerHTML = "Saved to user <span style='color: rgb(179, 161, 0)'>" + id + "</span>!";}
  
}

function fetchFromCloud(team) {
  var id;
  if(team == 1) {id = uindex1.value;}
  if(team == 2) {id = uindex2.value;}
  id = id.toUpperCase();
  var get = firebase.database().ref('users/' + id);
  get.on('value', (snapshot) => {
    try {
      const data = snapshot.val()['val'];
      console.log(data);
      if(team == 1) {
        team1List.innerHTML = '';
        for(i=0;i<parseInt(data.substr(0, 3));i++) {
          var newPlayer = addplayer(1, i);
          newPlayer.children[0].value = parseInt(data.substr(9*i + 3, 3));
          newPlayer.children[1].value = parseInt(data.substr(9*i + 6, 3));
          newPlayer.children[2].value = parseInt(data.substr(9*i + 9, 3));
        }
        team1Header.innerHTML = data.substr(9*parseInt(data.substr(0, 3)) + 3);
        message1.style.color = 'rgb(0, 113, 179)'
        message1.innerHTML = "Loaded!"
      } else {
        team2List.innerHTML = '';
        for(i=0;i<parseInt(data.substr(0, 3));i++) {
          var newPlayer = addplayer(2, i + 500);
          newPlayer.children[0].value = parseInt(data.substr(9*i + 3, 3));
          newPlayer.children[1].value = parseInt(data.substr(9*i + 6, 3));
          newPlayer.children[2].value = parseInt(data.substr(9*i + 9, 3));
        }
        team2Header.innerHTML = data.substr(9*parseInt(data.substr(0, 3)) + 3);
        message2.style.color = 'rgb(0, 113, 179)'
        message2.innerHTML = "Loaded!";
      }
    } catch (error) {
      if(team == 1) {message1.innerHTML = "Team not found"; message1.style.color = 'rgb(179, 161, 0)'}
      else {message2.innerHTML = "Team not found"; message2.style.color = 'rgb(179, 161, 0)'}
    }
  });
}

function clearPointers(that) {
  that.parentElement.children[0].style.outline = '';
  that.parentElement.children[1].style.outline = '';
  that.parentElement.children[2].style.outline = '';
  that.parentElement.children[3].style.outline = '';
}

document.getElementById('pointer0').onclick = function() {
  clearPointers(this);
  this.style.outline = 'solid white 1px';
  pointerAdd = -1;
}
document.getElementById('pointer1').onclick = function() {
  clearPointers(this);
  this.style.outline = 'solid white 1px';
  pointerAdd = 1;
}
document.getElementById('pointer2').onclick = function() {
  clearPointers(this);
  this.style.outline = 'solid white 1px';
  pointerAdd = 2;
}
document.getElementById('pointer3').onclick = function() {
  clearPointers(this);
  this.style.outline = 'solid white 1px';
  pointerAdd = 3;
}

pageColor.onchange = function() {
  //document.getElementById('body').style.color = this.value;
  document.getElementById('USTYLE').innerHTML = '*{color: ' + this.value + ';}' + 'input:read-only, input, input:focus:read-only, input:focus, button{background-color:' + buttonColor.value + '}'
}
backgroundColor.onchange = function() {
  //document.getElementById('body').style.color = this.value;
  document.getElementById('body').style.backgroundColor = this.value;
}
buttonColor.onchange = function() {
  //document.getElementById('body').style.color = this.value;
  //document.getElementById('USTYLE').style.backgroundColor = this.value;
  document.getElementById('USTYLE').innerHTML = '*{color: ' + pageColor.value + ';}' + 'input:read-only, input, input:focus:read-only, input:focus, button{background-color:' + this.value + ';}'
}

setupFirebase();

</script>